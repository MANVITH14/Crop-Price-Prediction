<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crop Price Prediction - Karnataka</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Bilingual Support Scripts -->
    <script src="{{ url_for('static', filename='js/translations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/language.js') }}"></script>
    <script src="{{ url_for('static', filename='js/audio.js') }}"></script>
    <script src="{{ url_for('static', filename='js/voice-guidance.js') }}"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="lang-toggle-container">
                <button id="lang-toggle" onclick="toggleLanguage()" aria-label="Switch language">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
            </div>
            <h1 data-translate="title">üåæ Tech-Enabled Crop Price Prediction System</h1>
            <p class="subtitle" data-translate="subtitle">Karnataka Agricultural Price Forecasting</p>
        </header>

        <main>
            <div class="info-box">
                <p><strong data-translate="lastUpdated">Last Updated:</strong> <span id="last-updated">{{ last_updated }}</span></p>
            </div>

            <div class="form-container">
                <form action="/predict" method="POST" id="prediction-form">
                    <div class="form-group">
                        <label for="crop" data-translate="selectCrop">Select Crop:</label>
                        <select name="crop" id="crop" required>
                            <option value="" data-translate="selectCropPlaceholder">-- Select Crop --</option>
                            {% for crop in crops %}
                            <option value="{{ crop }}" data-crop-en="{{ crop }}" data-crop-kn="">{{ crop }}</option>
                            {% endfor %}
                        </select>
                        <div class="selected-value" id="crop-selected">
                            <span class="selected-label" data-translate="selected">Selected:</span>
                            <span class="selected-text" id="crop-text" data-translate="none">None</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="district" data-translate="selectDistrict">Select District:</label>
                        <select name="district" id="district" required>
                            <option value="" data-translate="selectDistrictPlaceholder">-- Select District --</option>
                            {% for district in districts %}
                            <option value="{{ district }}" data-district-en="{{ district }}" data-district-kn="">{{ district }}</option>
                            {% endfor %}
                        </select>
                        <div class="selected-value" id="district-selected">
                            <span class="selected-label" data-translate="selected">Selected:</span>
                            <span class="selected-text" id="district-text" data-translate="none">None</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="date" data-translate="selectDate">Select Date:</label>
                        <input type="date" name="date" id="date" required min="{{ min_date }}" max="{{ max_date }}">
                        <div class="selected-value" id="date-selected">
                            <span class="selected-label" data-translate="selected">Selected:</span>
                            <span class="selected-text" id="date-text" data-translate="none">None</span>
                        </div>
                    </div>

                    <button type="submit" class="btn-predict" data-translate="predictPrice">Predict Price</button>
                </form>
            </div>

            <div class="info-section">
                <h2 data-translate="aboutTitle">About This System</h2>
                <ul>
                    <li><span data-translate="about1">‚úÖ Predicts prices for</span> <strong>Coconut</strong>, <strong>Arecanut</strong>, <strong>and</strong> <strong>Pepper</strong></li>
                    <li data-translate="about2">‚úÖ Covers all districts of Karnataka</li>
                    <li data-translate="about3">‚úÖ Uses Machine Learning (Random Forest) for accurate predictions</li>
                    <li data-translate="about4">‚úÖ Updates daily with latest market data</li>
                    <li data-translate="about5">‚úÖ Shows historical price trends</li>
                </ul>
            </div>
        </main>

        <footer>
            <p data-translate="footer">&copy; 2024 Crop Price Prediction System | Karnataka Agriculture</p>
        </footer>
    </div>

    <script>
        // Background color change based on selections
        const body = document.body;
        const cropSelect = document.getElementById('crop');
        const districtSelect = document.getElementById('district');
        const dateInput = document.getElementById('date');
        
        // Color schemes for different crops
        const cropColors = {
            'Coconut': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',      // Blue tones
            'Arecanut': 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',     // Green tones
            'Pepper': 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'        // Pink/Yellow tones
        };
        
        // Default background
        const defaultBg = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        
        function updateBackground() {
            const crop = cropSelect.value;
            const district = districtSelect.value;
            const date = dateInput.value;
            
            // If all three are selected, use crop-specific color
            if (crop && district && date) {
                const color = cropColors[crop] || defaultBg;
                body.style.background = color;
                body.style.transition = 'background 0.5s ease';
            }
            // If crop is selected, use crop color with reduced opacity effect
            else if (crop) {
                const color = cropColors[crop] || defaultBg;
                body.style.background = color;
                body.style.transition = 'background 0.5s ease';
            }
            // If only district or date selected, use subtle color
            else if (district || date) {
                body.style.background = 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)';
                body.style.transition = 'background 0.5s ease';
            }
            // Default background
            else {
                body.style.background = defaultBg;
                body.style.transition = 'background 0.5s ease';
            }
        }
        
        // Format date for display
        function formatDate(dateStr) {
            if (!dateStr) {
                const currentLang = getCurrentLanguage();
                return getTranslation(currentLang, 'none');
            }
            const date = new Date(dateStr + 'T00:00:00');
            const currentLang = getCurrentLanguage();
            const locale = currentLang === 'kn' ? 'kn-IN' : 'en-IN';
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString(locale, options);
        }
        
        // Update display when language changes
        document.addEventListener('languageChanged', function() {
            updateSelectedDisplay();
        });
        
        // Update selected value display and styling
        function updateSelectedDisplay() {
            const crop = cropSelect.value;
            const district = districtSelect.value;
            const date = dateInput.value;
            
            // Update crop display
            const currentLang = getCurrentLanguage();
            document.getElementById('crop-text').textContent = crop || getTranslation(currentLang, 'none');
            document.getElementById('crop-selected').style.display = crop ? 'flex' : 'none';
            // Update select styling
            if (crop) {
                cropSelect.style.backgroundColor = '#f0f7ff';
                cropSelect.style.borderColor = '#667eea';
                cropSelect.style.color = '#667eea';
                cropSelect.style.fontWeight = '600';
            } else {
                cropSelect.style.backgroundColor = 'white';
                cropSelect.style.borderColor = '#ddd';
                cropSelect.style.color = '#333';
                cropSelect.style.fontWeight = '500';
            }
            
            // Update district display
            document.getElementById('district-text').textContent = district || getTranslation(currentLang, 'none');
            document.getElementById('district-selected').style.display = district ? 'flex' : 'none';
            // Update select styling
            if (district) {
                districtSelect.style.backgroundColor = '#f0f7ff';
                districtSelect.style.borderColor = '#667eea';
                districtSelect.style.color = '#667eea';
                districtSelect.style.fontWeight = '600';
            } else {
                districtSelect.style.backgroundColor = 'white';
                districtSelect.style.borderColor = '#ddd';
                districtSelect.style.color = '#333';
                districtSelect.style.fontWeight = '500';
            }
            
            // Update date display
            const formattedDate = formatDate(date);
            document.getElementById('date-text').textContent = formattedDate || getTranslation(currentLang, 'none');
            document.getElementById('date-selected').style.display = date ? 'flex' : 'none';
            // Update input styling
            if (date) {
                dateInput.style.backgroundColor = '#f0f7ff';
                dateInput.style.borderColor = '#667eea';
                dateInput.style.color = '#667eea';
                dateInput.style.fontWeight = '600';
            } else {
                dateInput.style.backgroundColor = 'white';
                dateInput.style.borderColor = '#ddd';
                dateInput.style.color = '#333';
                dateInput.style.fontWeight = '500';
            }
        }
        
        // Add event listeners for all inputs
        cropSelect.addEventListener('change', function() {
            updateBackground();
            updateSelectedDisplay();
        });
        districtSelect.addEventListener('change', function() {
            updateBackground();
            updateSelectedDisplay();
        });
        dateInput.addEventListener('change', function() {
            updateBackground();
            updateSelectedDisplay();
        });
        
        // Initialize background and display on page load
        updateBackground();
        updateSelectedDisplay();
        
        // Update dropdown options when language changes
        function updateDropdownOptions() {
            const currentLang = getCurrentLanguage();
            
            // Update crop options
            const cropSelect = document.getElementById('crop');
            if (cropSelect) {
                Array.from(cropSelect.options).forEach(option => {
                    if (option.value) {
                        const cropName = getCropName(option.value, currentLang);
                        option.textContent = `${option.value} / ${cropName}`;
                    }
                });
            }
            
            // Update district options
            const districtSelect = document.getElementById('district');
            if (districtSelect) {
                Array.from(districtSelect.options).forEach(option => {
                    if (option.value) {
                        const districtName = getDistrictName(option.value, currentLang);
                        option.textContent = `${option.value} / ${districtName}`;
                    }
                });
            }
        }
        
        // Update options on language change
        document.addEventListener('languageChanged', function() {
            updateDropdownOptions();
            updateSelectedDisplay();
        });
        
        // Initial update
        updateDropdownOptions();
        
        // Form validation
        document.getElementById('prediction-form').addEventListener('submit', function(e) {
            const crop = document.getElementById('crop').value;
            const district = document.getElementById('district').value;
            const date = document.getElementById('date').value;

            if (!crop || !district || !date) {
                e.preventDefault();
                const currentLang = getCurrentLanguage();
                alert(getTranslation(currentLang, 'fillAllFields'));
                return false;
            }
        });
    </script>
</body>
</html>

